\input{preamble}
\input{tools}
\begin{document}
\title{Projectivity of moduli of curves}
\maketitle

\section{Stable curves}
\begin{lemma}[{\cite[\href{http://stacks.math.columbia.edu/tag/0E76}{Tag 0E76}]{stacks-project}.}]
\label{lemma-stable-curves}
There exist an open substack $\Curvesstack^{stable} \subset \Curvesstack$
such that
\begin{enumerate}
\item given a family of curves $f : X \to S$ the following are equivalent
\begin{enumerate}
\item the classifying morphism $S \to \Curvesstack$ factors
through $\Curvesstack^{stable}$,
\item $X \to S$ is a stable family of curves,
\end{enumerate}
\item given $X$ a scheme proper over a field $k$ with
$\dim(X) \leq 1$ the following are equivalent
\begin{enumerate}
\item the classifying morphism $\Spec(k) \to \Curvesstack$
factors through $\Curvesstack^{stable}$,
\item the singularities of $X$ are at-worst-nodal, $\dim(X) = 1$,
$k = H^0(X, \mathcal{O}_X)$, the genus of $X$ is $\geq 2$, and
$X$ has no rational tails or bridges,
\item the singularities of $X$ are at-worst-nodal, $\dim(X) = 1$,
$k = H^0(X, \mathcal{O}_X)$, and $\omega_{X_s}$ is ample.
\end{enumerate}
\end{enumerate}
\end{lemma}

\section{Semipositivity Results}
In this section, we prove a semipositivity result,
Lemma \ref{lemma-stable-curves-semipositive}, for the pushforward of the
relative dualizing sheaf of families of curves.

\begin{lemma}
Let $k$ be a field.
Let $f : S \to C$ be a flat family of curve...\todo{Formulate the hypotheses of
this better; this is Kollar's Proposition 4.5.}
If $k \geq 2$, then $f_*\omega_{S/C}^{\otimes m}$ is semipositive for $m \geq 2$.
\end{lemma}

\begin{proof}
Assume $S$ smooth surface, $C$ smooth curve of genus $g\leq 2$ and $f:S\to C$ with smooth generic fiber. We want to  reduce to the case of genus $g>2$ preserving smoothness.

Choose a branched cover $C'\to C$ such that $C'$ is smooth of $g>2$. Using that the generic fiber of $f$ is smooth, the fiber product $S'$ is smooth.

$$
\xymatrix{
S \ar[d]^f  &S' \ar[d]^{f'} \ar[l]^{\pi'} \\
C   &C' \ar[l]^{\pi}
}
$$

Then by commutativity and $H^1=0$ we have $$\pi^*(f_*(\omega_{S/C}))=f'_*\pi'^*(\omega_{S/C})=f'_*(\omega_{S'/C'})$$ using that $\pi'^*(\omega_{S/C})=\omega_{S'/C'}$.

If on $C$ we have $\mathcal{E}\to \mathcal{Q}\to 0$ where $\mathcal{Q}$ is an invertible sheaf of $\deg \mathcal{Q}<0$, then on $C'$ we have $\pi^*\mathcal{E}\to \pi^*\mathcal{Q}\to 0$ still with $\deg \pi^*\mathcal{Q}<0$. So it suffices to show semipositivity on $C'$ by using that genus $g(C')>2$.

So we can assume $S$ is smooth of general type and $C$ is smooth of genus $g>2$. Let $S_{min}$ be the minimal model of $S$ as in the diagram:

$$
\xymatrix{
S \ar[d]^f \ar[r]^{\pi} &S_{min} \ar[ld]^g\\
C
}
$$

Then
\begin{align*}
f_*(\omega^{\otimes m}_{S/C}) & =g_*\pi_*(\omega^{\otimes m}_{S/C})=g_*\pi_*(\omega^{\otimes m}_{S/S_{min}}\otimes \pi^*\omega^{\otimes m}_{S_{min}/C})\\ & =g_*(\pi_*\omega^{\otimes m}_{S/S_{min}}\otimes \omega^{\otimes m}_{S_{min}/C})=g_*\omega^{\otimes m}_{S_{min}/C}
\end{align*}
because $\pi_*\omega^{\otimes m}_{S/S_{min}}=\mathcal{O}_{S_{min}}$ \todo{Explain why the last thing}

Hence, we can assume that $S$ is of general type and minimal.

If $char k=0$ use spreading out \todo{Add the argument}. So we can assume $char k=p>0$. In this case we have the Frobenius map $F:C\to C$ within the diagram

$$
\xymatrix{
S \ar[d]^f  &S \ar[d]^{f'} \ar[l]^{F} \\
C   &C \ar[l]^{F}
}
$$

So if we have a quotient $$f_*(\omega^{\otimes m}_{S/C})\to \mathcal{M}^{-1}\to 0$$ with $\mathcal{M}$ an invertible sheaf of degree $\deg \mathcal{M}=d$. Using that the dualizing sheaf commutes with the Frobenius map we have $$F^*f_*(\omega^{\otimes m}_{S/C})=f'_*F^*(\omega^{\otimes m}_{S/C})=f'^*(\omega^{\otimes m}_{S/C})$$ Combining we have the quotient $$f'^*(\omega^{\otimes m}_{S/C})=F^*f_*(\omega^{\otimes m}_{S/C})\to F^*\mathcal{M}^{-1}\to 0$$ with $\deg F^*\mathcal{M}=dp$. Hence, we can assume that $\deg \mathcal{M}=d>>0$.

Therefore, we can assume that $\mathcal{M}\cong \omega^{\otimes m+t-1}\otimes \mathcal{L}$ where $\mathcal{L}$ is very ample and $t\geq 1$. Using that $\deg \mathcal{M}=d>>0$ the invertible sheaf $\mathcal{M}$ is generated by global sections $$\mathcal{O}_{C}\to \mathcal{M}\cong \omega^{\otimes m+t-1}\otimes \mathcal{L}\to 0$$ Rearranging we get $$\omega_C^{\otimes m}\otimes \mathcal{L} \otimes f_*(\omega^m_{S/C})\to \omega_C^{1-t}\to 0$$ From the long exact sequence for cohomology we get $$H^1(C, \omega^{\otimes m}_C\otimes \mathcal{L}\otimes f_*(\omega^{\otimes m}_{S/C}))\to H^1(\omega_C^{1-t})\to 0$$

By Serre Duality we have $$H^1(\omega_C^{1-t})\cong H^0(\omega_C^t)$$ so when $t=1$ we have $$\dim_k H^1(\omega_C^{1-t})=\dim H^0(\omega_C)=g$$ Therefore, $$\dim_k H^1(C, \omega^{\otimes m}_C\otimes \mathcal{L}\otimes f_*(\omega^{\otimes m}_{S/C}))\geq g$$

From the Leray spectral sequence for $\mathcal{F}=f^*(\omega^{\otimes m}_C\otimes \mathcal{L})\otimes \omega^{\otimes m}_{S/C}$ we have $$E_2: \quad H^p(C, R^qf_*\mathcal{F})\implies H^{p-q}(S,\mathcal{F})$$

The only nonzero entries on the $E_2$ page are:
\begin{center}
$H^1(C, f_*\mathcal{F})$\quad  \quad $H^1(C, R^1f_*\mathcal{F})$\\
$H^0(C, f_*\mathcal{F})$ \quad \quad $H^0(C,R^1f_\mathcal{F})$
\end{center}

Hence, we have the exact sequence $$0\to H^1(C, f_*\mathcal{F})\to H^1(S, \mathcal{F})\to H^0(C, R^1f_*\mathcal{F})\to 0$$

Since $$\mathcal{F}=f^*(\omega^{\otimes m}_C\otimes \mathcal{L})\otimes \omega^{\otimes m}_{S/C}$$ we have $$f_*\mathcal{F}=f_*(f^*(\omega^{\otimes m}_C\otimes \mathcal{L})\otimes \omega^{\otimes m}_{S/C})=\mathcal{L}\otimes f_*\omega^{\otimes m}_{S/C}\otimes \omega^m_C=\mathcal{L}\otimes f_*(f^*(\omega^{\otimes m}_C)\otimes \omega^{\otimes m}_{S/C})=\mathcal{L}\otimes \omega^{\otimes m}_S$$

So on $S$, we have $\mathcal{F}=\omega_S^{\otimes m}\otimes f^*\mathcal{L}$. Therefore, $$g\leq \dim_k H^1(C, \omega^{\otimes m}_C\otimes \mathcal{L}\otimes f_*(\omega^{\otimes m}_{S/C}))=\dim_k H^1(C, f_*\mathcal{F})$$ Then from the exact sequence we get $$\dim_k H^1(S,\mathcal{F})\geq \dim_k H^1(C, f_*\mathcal{F})\geq g$$ i.e. $\dim_k H^1(C, \omega_S^{\otimes m}\otimes f^*\mathcal{L})\geq g$.

The invertible sheaf $\mathcal{L}$ is very ample on $C$ and hence $f^*\mathcal{L}$ is effecitve. Thus, it's of the fom $f^*\mathcal{L}\cong \mathcal{O}_S(D)$.

Then we get an exact sequence $$0\to \omega_S^{\otimes m}\to \omega^{\otimes m}_S\otimes f^*\mathcal{L}\to (\omega_S^{\otimes m}\otimes f^*\mathcal{L})|_D\to 0$$ From the long exact sequence for cohomology we get $$H^0(\omega^{\otimes m}_S\otimes f^*\mathcal{L}|_D)\to H^1(\omega_S^{\otimes m})\to H^1(\omega_S^{\otimes m}\otimes f^*\mathcal{L})\to H^1(\omega_S^{\otimes m}\otimes f^*\mathcal{L}|_D)$$

Note that $D|_D=0$ and hence $$(mK_S+D)|_D=(mK_S+mD)|_D=K_D$$ where the last equality follows from the adjunction formula. Then for $m\geq 2$ we get $$H^1(\omega_S^{\otimes m}\otimes f^*\mathcal{L}|_D)\cong H^1(\omega_D^{\otimes m})\cong H^0(\omega_D^{\otimes m-1})=0$$ using the Serre duality.

Thus, $$H^1(\omega_S^{\otimes m})\to H^1(\omega_S^{\otimes m}\otimes f^*\mathcal{L})\to 0$$ and so $$\dim_k H^1(\omega_S^{\otimes m})\geq \dim_k H^1(\omega_S^{\otimes m}\otimes f^*\mathcal{L})=g\geq 2$$

This contradicts Ekedahl's Theorem \todo{add reference}, which states that for $X$ be a minimal of genereal type surface for $i\geq 2$ we have $$H^1(\omega_X^{\otimes i})=\begin{cases} 0 &char k>2\\ \leq 1 & char k=2\end{cases}$$

The same techniques can be used to make $\dim H^1$ as large as necessary. This takes care of the case when $char k=2$
\end{proof}


\begin{lemma}
\label{lemma-stable-curves-semipositive-resolve}
Let $k$ be a field.
Let $C$ be a proper smooth $k$-scheme of dimension $1$.
Let $f : S \to C$ be a flat morphism whose fibres are stable nodal and arithmetic
genus $g \geq 2$.
\end{lemma}

\begin{lemma}[cf.\ {\cite[Theorem 4.3]{Ko90}}]
\label{lemma-stable-curves-semipositive}
Let $k$ be a field.
Let $C$ be a proper connected smooth $k$-scheme of dimension $1$.
Let $f : S \to C$ be a family of stable curves,
as defined in Lemma \ref{lemma-stable-curves}.
Then $f_*(\omega_{S/C}^{\otimes m})$ is semipositive for $m \geq 2$.


\end{lemma}


\begin{lemma}[cf.\ {\cite[Theorem 4.6]{Ko90}}]
\label{lemma-stable-curves-semipositive}
Let $k$ be a field.
Let $C$ be a proper connected smooth $k$-scheme of dimension $1$.
Let $f : S \to C$ be a family of stable curves,
as defined in Lemma \ref{lemma-stable-curves}.
Let $C_t$ be a section of $f$.
Then $\omega_{S/c}\cdot C_t\geq 0$.
\end{lemma}

\begin{proof}
Let $i:C_t\hookrightarrow S$ be the inclusion map, and $g=f\circ i:C_t\to C$ be the corresponding isomorphism.
Consider the short exact sequence:
$$0\to \mathcal{O}_S(-C_t)\to\mathcal{O}_S\to i_*\mathcal{O}_{C_t}\to 0.$$
Tensoring with $\omega_{S/C}^{\otimes m}$, we obtain:
$$0\to \omega_{S/C}^{\otimes m}(-C_t)\to \omega_{S/C}^{\otimes m}\to i_*\mathcal{O}_{C_t}\otimes\omega_{S/C}^{\otimes m}\to 0.$$
Applying the functor $f_*$ to the sequence, we get a map
$$f_*\omega_{S/C}^{\otimes m}\to f_*(i_*\mathcal{O}_{C_t}\otimes \omega_{S/C}^{\otimes m})\to R^1f_*(\omega_{S/C}^{\otimes m}(-C_t)).$$
For $k\gg 0$, using cohomology and base change we obtain $R^1f_*(\omega_{S/C}^{\otimes m}(-C_t))=0$, so we have a surjection:
$$f_*\omega_{S/C}^{\otimes m}\to f_*(i^*\mathcal{O}_{C_t}\otimes \omega_{S/C}^{\otimes m})\to 0.$$
Applying the functor $g^*$ to the above sequence, we obtain:
$$g^*f_*\omega_{S/C}^{\otimes m}\to g^*f_*(i^*\mathcal{O}_{C_t}\otimes \omega_{S/C}^{\otimes m})\to 0.$$
We now claim that the term on the right is $i^*\omega_{S/C}^{\otimes m}$, since
\begin{align}
i^*\omega_{S/C}^{\otimes m}& =g^*g_*(i^*\omega_{S/C}^{\otimes m})\nonumber\\
& =g^*f_*i_*(i^*\omega_{S/C}^{\otimes m})\nonumber\\
&=g^*f_*(i^*\mathcal{O}_{C_t}\otimes \omega_{S/C}^{\otimes m}).\nonumber
\end{align}
This way we obtain a contradiction, since the quotient $g^*f_*\omega_{S/C}^{\otimes m}\to i^*\omega_{S/C}^{\otimes m}\to 0$ contradicts semipositivity.
\end{proof}


\begin{definition}[cf.\ {\cite[Definition 4.1(i)]{Ko90}}]
\label{definition-semismooth}
Let $k$ be a field.
Let $X$ be an algebraic variety over $k$.
We say $X$ is {\it semismooth} if all of its closed points are analytically
isomorphic to one of the following:
\begin{enumerate}
\item a smooth point;
\item a double crossing point $\{x_1x_2 = 0\} \subset \mathbf{A}^n$; or
\item a pinch point $\{x_1^2 - x_2^2x_3 = 0\} \subset \mathbf{A}^n$.
\end{enumerate}
In this case the singular locus is smooth, and we call it the {\it double
divisor} of $X$.
\end{definition}

\begin{situation}
\label{situation-kollar-theorem-4.3}
Let $k$ be a field.
Let $S$ be a complete Gorenstein reduced $k$-scheme of dimension $2$ that is
semismooth.
Let $C$ be a complete integral smooth $k$-scheme of dimension $1$.
Let $f : S \to C$ be a surjective map onto $C$, such that the general fiber of
$f$ has only nodes as singularities.
\end{situation}

\begin{lemma}
\label{lemma-base-change-okay}
Consider Situation \ref{situation-kollar-theorem-4.3}.
Let $C'$ be a complete integral smooth $k$-scheme of dimension $1$, and
consider the cartesian square
$$
\xymatrix{
S' \ar[d]_{f'}\ar[r]^{g'} & S\ar[d]^f\\
C' \ar[r]^g & C
}
$$
where $g: C' \to C$ is surjective.
If for some $m$, the sheaf $f'_*(\omega_{S'/C'}^{\otimes m})$ is semipositive,
then $f_*(\omega_{S/C}^{\otimes m})$ is semipositive.
\end{lemma}
\begin{proof}
Suppose $f_*(\omega_{S/C}^{\otimes m})$ is not semipositive, i.e., there
exists a quotient
$$f_*(\omega_{S/C}^{\otimes m}) \longrightarrow \mathcal{L}$$
where $\mathcal{L}$ is an invertible sheaf of negative degree.
Pulling back to $C'$, we then obtain a quotient
$$g^*f_*(\omega_{S/C}^{\otimes m}) \longrightarrow g^*\mathcal{L}$$
of $g^*f_*(\omega_{S/C}^{\otimes m})$ that has negative degree on $C'$.
Since $f$ is flat \cite[\href{http://stacks.math.columbia.edu/tag/00R4}{Tag
00R4}]{stacks-project}, we can apply flat base change
\cite[\href{http://stacks.math.columbia.edu/tag/02KH}{Tag 02KH}]{stacks-project}
to obtain
$$
g^*f_*(\omega_{S/C}^{\otimes m})
\simeq f'_*g'^*(\omega_{S/C}^{\otimes m})
\simeq f'_*(\omega_{S'/C'}^{\otimes m})
$$
where the second isomorphism is
by the compatibility of the relative dualizing sheaf with pullbacks
\cite[\href{http://stacks.math.columbia.edu/tag/0E4P}{Tag
0E4P}]{stacks-project}.
We therefore obtain a negative quotient $g^*\mathcal{L}$ of
$f'_*(\omega_{S'/C'}^{\otimes m})$, which contradicts the assumption that
$f'_*(\omega_{S'/C'}^{\otimes m})$ was semipositive.
\end{proof}

\begin{theorem}[cf.\ {\cite[Theorem 4.3]{Ko90}}]
\label{theorem-kollar-theorem-4.3}
In Situation \ref{situation-kollar-theorem-4.3}, suppose moreover that the
generic fiber of $f$ is a stable curve. Then,
the sheaf $f_*(\omega_{S/C}^{\otimes m})$ is semipositive for $m \ge 2$.
\end{theorem}
\begin{proof}
We first claim that we may assume that every double curve in $S$ dominates $C$.
Suppose that a double curve $D$ maps to a point in $C$.
Blowing up $D$ gives a map $b :
\widetilde{S} \to S$.
Suppose we know the sheaf $(b \circ f)_*(\omega_{\widetilde{S}/C}^{\otimes m})$
is semipositive.
The Grothendieck trace morphism
$$
\mathrm{Tr}_b : b_*(\omega_{\widetilde{S}/C}^{\otimes m})
\longrightarrow \omega_{S/C}^{\otimes m}
$$
for the blowup is injective, since $b$ is birational, and is an isomorphism away
from $D$ \cite[Prop.\ 5.77]{KM}.
We therefore have a short exact sequence
$$
0 \longrightarrow b_*(\omega_{\widetilde{S}/C}^{\otimes m})
\longrightarrow \omega_{S/C}^{\otimes m} \longrightarrow \mathcal{Q}
\longrightarrow 0,
$$
where $\mathcal{Q}$ is supported in $D$.
Pushing this forward $\mathrm{Tr}_b$ to the curve $C$, we then have the
left-exact sequence
$$
0 \longrightarrow (f \circ b)_*(\omega_{\widetilde{S}/C}^{\otimes m})
\longrightarrow f_*(\omega_{S/C}^{\otimes m}) \longrightarrow f_*\mathcal{Q}.
$$
Since $D$ is contained in a fiber over $C$, the sheaf $f_*\mathcal{Q}$ is a
skyscraper sheaf supported at a point on $C$.
We can therefore replace $f_*\mathcal{Q}$ with the subsheaf $\mathcal{Q}'$
making the sequence
$$
0 \longrightarrow (f \circ b)_*(\omega_{\widetilde{S}/C}^{\otimes m})
\longrightarrow f_*(\omega_{S/C}^{\otimes m}) \longrightarrow \mathcal{Q}'
\longrightarrow 0
$$
exact.
Since $\mathcal{Q}'$ is a skyscraper sheaf, it has positive degree on $C$.
Thus, assuming $(f \circ b)_*(\omega_{\widetilde{S}/C}^{\otimes m})$ is
semipositive, we have that $f_*(\omega_{S/C}^{\otimes m})$ is also.
After repeating finitely many blowups of double curves not dominating $C$,
all remaining double curves will dominate $C$.

We now claim that we may assume $S$ has no pinch points. If there are pinch
points, then blowing them up gives a new surface birational to $S$ that only has
double crossing points; the argument of the previous paragraph shows we may
reduce to this case, since pinch points are isolated (as in, there cannot be a
curve that consists wholely of pinch points).

We now claim that we may assume that every double curve $D$ in $S$ is a
section of $f : S \to C$.
If it is not, then consider the base change by $g : D \to C$:
$$
\xymatrix{
S \times_C D \ar[r]^{g'}\ar[d]_{f'} & S \ar[d]^f\\
D \ar[r]^g & C
}
$$
It suffices to show the statement of the Theorem for the morphism $f'$ by Lemma
\ref{lemma-base-change-okay}, and the inverse image of $D$ in $S \times_C D$ is
now a section of $f'$ by using the cartesianness of the square:
$$
\xymatrix{
D\ar@{=}@/_/[ddr]\ar@{^{(}->}@/^/[drr]\ar@{-->}[dr]\\
& S \times_C D \ar[r]^{g'}\ar[d]_{f'} & S \ar[d]^f\\
& D \ar[r]^g & C
}
$$
Repeating finitely many base changes, we can ensure that every double curve is a
section of $f : S \to C$.

We now claim that if $\nu : S' \to S$ is the normalization of $S$, then the
preimage $D'$ of the double curve $D$ still consists of sections.
Since the double curve only consists of double crossing points, the
normalization (analyticall) locally splits up the double curve into two separate
curves on two different irreducible components.
These two curves will still be sections.

We have therefore reduced the statement to the situation of Lemma
\ref{kollar-theorem-4.9}.
%We are now at the top of p. 255
\end{proof}






\section{Semipositivity after twisting by sections}

\begin{situation}\label{kollar_prop_4.7}
Let $k$ be a field.
Let $C$ be a proper smooth $k$-scheme of dimension 1.
Let $S$ be a proper smooth $k$-scheme of dimension 2.
Let $f:S\to C$ be a family of stable nodal curves whose fibers have arithmetic genus $g$.
Let $C_1,\ldots,C_n$ be a set of pairwise distinct sections of $f$.
Let $m\ge2$ be an integer.
Let $a_1,\ldots,a_n$ be non-negative integers such that $a_i\le m$ for each $i$.
\end{situation}

\begin{lemma}\label{base_case_genus_0}
Suppose we are in Situation \ref{kollar_prop_4.7} where $g=0$ and the sections $C_i$ are pairwise disjoint.
Assume that $\sum a_i\le 2k-1$.
Then $f_{*}(\omega_{S/C}^{\otimes m}(\sum a_iC_i))=0$.
\end{lemma}
\begin{proof}
Immediate from the fact that the sheaf $\omega_{S/C}^{\otimes m}(\sum a_iC_i)$ has negative degree on each fiber of $f$.
\end{proof}

\begin{lemma}\label{base_case_genus_1}
Suppose we are in Situation \ref{kollar_prop_4.7} where $g=1$ and the sections $C_i$ are pairwise disjoint.
Then $f_{*}(\omega_{S/C}^{\otimes m})$ is a semipositive locally free sheaf.
\end{lemma}
\begin{proof}
\todo{still don't understand what kollar is doing here}
\end{proof}

\begin{lemma}\label{inductive_step_genus_0}
Suppose we are in Situation \ref{kollar_prop_4.7} where $g=0$ and the sections $C_i$ are pairwise disjoint.
Then $f_{*}(\omega_{S/C}^{\otimes m}(\sum a_iC_i))$ is a semipositive locally free sheaf.
\end{lemma}
\begin{proof}
This proof is nearly identical to that in genus 1 and genus at least 2.

We proceed by induction on $\sum a_i$.
By the Hodge Index Theorem, we may assume that among $C_1,\ldots,C_n$, $C_1$ is the only section with positive self-intersection.
The base cases where $a_i\le 2m-1$ is Lemma \ref{base_case_genus_0}.

Assume the claim is proven for $D_{j-1}=\sum a_iC_i$ where $\sum a_i\ge 2m-1$; we will prove it for $D_{j}=D_{j-1}+C_t$.
Because $a_{1}\le m$, we may assume $C_1\neq C_t$.
By the adjunction formula, $\omega_{S/C}(C_t)|_{C_t}\cong\mathcal{O}_{C_t}$, so $\omega_{S/C}\cdot C_t=-C_t^2\ge0$, as $C_t\neq C_1$.

Consider the exact sequence
\begin{equation*}\label{exact_seq_of_section_twisted_genus_0}
0\to\omega_{S/C}^{\otimes m}(D_{j-1})\to\omega_{S/C}^{\otimes m}(D_j)\to \omega_{S/C}^{\otimes m}(D_j)|_{C_t}\to0
\end{equation*}
obtained by tensoring the closed subscheme exact sequence for $C_t$ with $\omega_{S/C}^{\otimes m}(D_j)$.

Then, $\omega_{S/C}^{\otimes m}(D_j)|_{C_t}\cong \omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$, because the $C_i$ are pairwise disjoint.
Because $a_{t}+1\le k$ by assumption, this invertible sheaf has non-negative degree.

We now claim that $R^{1}f_{*}\omega_{S/C}^{\otimes m}(D_{j-1}))=0$.
Indeed, by Cohomology and Base Change and the fact that $f$ has relative dimension 1, it suffices to note that $H^{1}(S_x,\omega_{S_x/\kappa(x)}^{\otimes m}(D_{j-1}\cdot S_x))=0$ for each fiber $S_x$ of $f$, which is clear by Serre Duality and degree considerations.

Thus, applying $f_{*}$ to (\ref{exact_seq_of_section_twisted_genus_0}) expresses $f_{*}(\omega_{S/C}^{\otimes m}(\sum a_iC_i))$ as an extension of the positive degree invertible sheaf $f_{*}\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ by the semipositive locally free sheaf $f_{*}\omega_{S/C}^{\otimes m}(D_{j-1})$, which is semipositive by \todo{ref to semipositivity section}.
Here we have used the fact that $C_t$ is a section, hence $f_{*}\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ is an invertible sheaf on $C$ of the same degree as that of $\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ on $C_t$.
\end{proof}

\begin{lemma}\label{inductive_step_genus_1}
Suppose we are in Situation \ref{kollar_prop_4.7} where $g=1$ and the $C_i$ are pairwise disjoint.
Then $f_{*}(\omega_{S/C}^{\otimes m}(\sum a_iC_i))$ is a semipositive locally free sheaf.
\end{lemma}
\begin{proof}
This proof is nearly identical to that in genus 0 and genus at least 2.

We proceed by induction on $\sum a_i$.
The base case where all of the $a_i$ are equal to zero is Lemma \ref{base_case_genus_1}.

Assume the claim is proven for $D_{j-1}=\sum a_iC_i$; we will prove it for $D_{j}=D_{j-1}+C_t$.
By \todo{THIS DOESN'T WORK!}, $\omega_{S/C}\cdot C_t\ge0$.

Consider the exact sequence
\begin{equation}\label{exact_seq_of_section_twisted_genus_1}
0\to\omega_{S/C}^{\otimes m}(D_{j-1})\to\omega_{S/C}^{\otimes m}(D_j)\to \omega_{S/C}^{\otimes m}(D_j)|_{C_t}\to0
\end{equation}
obtained by tensoring the closed subscheme exact sequence for $C_t$ with $\omega_{S/C}^{\otimes m}(D_j)$.

Then, $\omega_{S/C}^{\otimes m}(D_j)|_{C_t}\cong \omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$, because the $C_i$ are pairwise disjoint.
Because $a_{t}+1\le k$ by assumption, this invertible sheaf has non-negative degree.

We now claim that $R^{1}f_{*}\omega_{S/C}^{\otimes m}(D_{j-1}))=0$, unless $D_{j-1}=0$.
Indeed, by Cohomology and Base Change and the fact that $f$ has relative dimension 1, it suffices to note that $H^{1}(S_x,\omega_{S_x/\kappa(x)}^{\otimes m}(D_{j-1}\cdot S_x))=0$ for each fiber $S_x$ of $f$, which is clear by Serre Duality and degree considerations.
On the other hand, when $D_{j-1}=0$, Cohomology and Base Change shows that $R^{1}f_{*}\omega_{S/C}^{\otimes m}(D_{j-1}))$ is an invertible sheaf.


Thus, if $D_{j-1}\neq0$, applying $f_{*}$ to (\ref{exact_seq_of_section_twisted_genus_1}) expresses $f_{*}(\omega_{S/C}^{\otimes m}(\sum a_iC_i))$ as an extension of the positive degree invertible sheaf $f_{*}\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ by the semipositive locally free sheaf $f_{*}\omega_{S/C}^{\otimes m}(D_{j-1})$, which is semipositive by \todo{ref to semipositivity section}.
Here we have used the fact that $C_t$ is a section, hence $f_{*}\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ is an invertible sheaf on $C$ of the same degree as that of $\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ on $C_t$.

If $D_{j-1}=0$, the situation is similar; we obtain the exact sequence
$$
0\to f_{*}(\omega_{S/C}^{\otimes m})\to f_{*}((\omega_{S/C}^{\otimes m})(C_t))\to f_{*}((\omega_{S/C}^{\otimes m})(C_t))|_{C_t}\to R^{1}f_{*}(\omega_{S/C}^{\otimes m})\to0
$$
because $R^{1}f_{*}\omega_{S/C}^{\otimes m}(C_t)=0$.
The rightmost map is a surjection of invertible sheaves, hence an isomorphism.
Therefore the leftmost map is an isomorphism as well, and we obtain the desired conclusion once again.
\end{proof}



\begin{lemma}\label{inductive_step_genus_2}
Suppose we are in Situation \ref{kollar_prop_4.7} where $g\ge2$ and the sections $C_i$ are pairwise disjoint.
Then $f_{*}(\omega_{S/C}^{\otimes m}(\sum a_iC_i))$ is a semipositive locally free sheaf.
\end{lemma}
\begin{proof}
This proof is nearly identical to that in genus 0 and genus 1.

We proceed by induction on $\sum a_i$.
The base case where all of the $a_i$ are equal to zero is Lemma \todo{insert ref to kollar 4.5}.

Assume the claim is proven for $D_{j-1}=\sum a_iC_i$; we will prove it for $D_{j}=D_{j-1}+C_t$.
By \todo{insert ref to our version of kollar 4.6}, $\omega_{S/C}\cdot C_t\ge0$.

Consider the exact sequence
\begin{equation*}\label{exact_seq_of_section_twisted_genus_2}
0\to\omega_{S/C}^{\otimes m}(D_{j-1})\to\omega_{S/C}^{\otimes m}(D_j)\to \omega_{S/C}^{\otimes m}(D_j)|_{C_t}\to0
\end{equation*}
obtained by tensoring the closed subscheme exact sequence for $C_t$ with $\omega_{S/C}^{\otimes m}(D_j)$.

Then, $\omega_{S/C}^{\otimes m}(D_j)|_{C_t}\cong \omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$, because the $C_i$ are pairwise disjoint.
Because $a_{t}+1\le k$ by assumption, this invertible sheaf has non-negative degree.

We now claim that $R^{1}f_{*}\omega_{S/C}^{\otimes m}(D_{j-1}))=0$.
Indeed, by Cohomology and Base Change and the fact that $f$ has relative dimension 1, it suffices to note that $H^{1}(S_x,\omega_{S_x/\kappa(x)}^{\otimes m}(D_{j-1}\cdot S_x))=0$ for each fiber $S_x$ of $f$, which is clear by Serre Duality and degree considerations.

Thus, applying $f_{*}$ to (\ref{exact_seq_of_section_twisted_genus_2}) expresses $f_{*}(\omega_{S/C}^{\otimes m}(\sum a_iC_i))$ as an extension of the positive degree invertible sheaf $f_{*}\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ by the semipositive locally free sheaf $f_{(}\omega_{S/C}^{\otimes m}(D_{j-1})$, which is semipositive by \todo{ref to semipositivity section}.
Here we have used the fact that $C_t$ is a section, hence $f_{*}\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ is an invertible sheaf on $C$ of the same degree as that of $\omega_{S/C}^{\otimes (k-a_{t}-1)}|_{C_t}$ on $C_t$.
\end{proof}

\begin{lemma}
Suppose we are in Situation \ref{kollar_prop_4.7}.
Then $f_{*}\left(\omega_{S/C}^{\otimes m}\left(\sum a_iC_i\right)\right)$ is semipositive.
\end{lemma}
\begin{proof}
Let $b:\widetilde{S}/\to S$ be a blowup morphism such that the proper transforms $C'_i$ of the $C_i$ are pairwise disjoint, and are sections of $f\circ b$.
By Lemma \ref{inductive_step_genus_0}, Lemma \ref{inductive_step_genus_1}, and Lemma \ref{inductive_step_genus_2}, $(f\circ b)_{*}\omega_{\widetilde{S}/C}^{\otimes m}$ is semipositive.

The Grothendieck trace morphism
$$
\mathrm{Tr}_b : b_*(\omega_{\widetilde{S}/C}^{\otimes m})
\longrightarrow \omega_{S/C}^{\otimes m}
$$
for the blowup is injective, since $b$ is birational, and is an isomorphism away
from $D$ \cite[Prop.\ 5.77]{KM}. Tensoring with $\mathcal{O}_{S}\left(\sum a_iC_i\right)$ and applying the projection formula yields an injection
$$
\mathrm{Tr}'_b : b_*\left(\omega_{\widetilde{S}/C}^{\otimes m}\otimes\mathcal{O}_{\widetilde{S}}\left(\sum a_ib^{*}C_i\right)\right)
\longrightarrow \omega_{S/C}^{\otimes m}\left(\sum a_iC_i\right).
$$
Therefore, we have an injection
$$
\mathrm{Tr}'':(f\circ b)_{*}\left(\omega_{\widetilde{S}/C}^{\otimes m}\otimes\mathcal{O}_{\widetilde{S}}\left(\sum a_iC'_i\right)\right)
\longrightarrow f_{*}\left(\omega_{S/C}^{\otimes m}\left(\sum a_iC_i\right)\right)
$$
after precomposing with the inclusions of $C'_i$ into $b^*C_i$ and applying $f_*$. 

Because $b$ is a blowup of points on $S$, $\mathrm{Tr}''$ is generically an isomorphism. 
We thus conclude that an invertible quotient of $\mathcal{L}$ of $f_{*}\left(\omega_{S/C}^{\otimes m}\left(\sum a_iC_i\right)\right)$ has a subsheaf that is a quotient of $(f\circ b)_{*}\left(\omega_{\widetilde{S}/C}^{\otimes m}\otimes\mathcal{O}_{\widetilde{S}}\left(\sum a_iC'_i\right)\right)$, and thus must have non-negative degree by the semipositivity of $(f\circ b)_{*}\left(\omega_{\widetilde{S}/C}^{\otimes m}\otimes\mathcal{O}_{\widetilde{S}}\left(\sum a_iC'_i\right)\right)$.
This completes the proof.
\end{proof}

\begin{lemma}[cf.\ {\cite[Theorem 4.9]{Ko90}}]
\label{kollar-theorem-4.9}
Let $k$ be a field.
Let $C$ be a proper connected smooth $k$-scheme of dimension $1$.
Let $S$ be a semismooth surface.
Let $f:S\to C$ be a surjective map whose general fiber is a stable curve.
Let $D$ be a double curve on $S$.
Assume $D$ consists of section of $f:S\to C$.
Let $g:S'\to S$ be the normalization of $S$.
Let $D'=g^{-1}(D)$.
Assume each component of $D'$ is a section.
Let $m\geq 2$ any integer.
Then $f_*(\omega_{S/C}^{\otimes m})$ is semipositive.
\end{lemma}
\begin{proof}
By \ref{kollar_prop_4.7} we know that $(f\circ g)_*(\omega_{S'/C}^{\otimes m})$ is semipositive.
Observe that $g^*\omega_{S/C}\cong \omega_{S'/C}(D')$.
Now we consider the short exact sequence;
$$0\to\mathcal{O}_{S}(-D)\to\mathcal{O}_S\to\mathcal{O}_D\to 0.$$
We tensor the sequence with $\omega_{S/C}$ and obtain:
$$0\to g_*(\omega_{S'/C})\to \omega_{S/C}\to \omega_{S/C}|D\cong \mathcal{O}_D\to 0.$$
Now we tensor the sequence with $\omega_{S/C}^{\otimes (m-1)}$ and apply the projection formula, obtaining:
$$0\to g_*\omega_{S'/C}^{\otimes m}((m-1)D')\to \omega_{S/C}^{\otimes m}\to \mathcal{O}_D\to 0.$$
 Now we apply the functor $f_*$ to the sequence and use that $R^1(f\circ g)_*\omega_{S'/C}^{\otimes m}((m-1)D')=0$ for $m\geq 2$, obtaining the following sequence:
 $$0\to (f\circ g)_*\omega_{S'/C}^{\otimes m}((m-1)D')\to f_*\omega_{S/C}^{\otimes m}\to f_*\mathcal{O}_D\to 0.$$
 $f_*\mathcal{O}_D$ is isomorphic to the sum of copies of $\mathcal{O}_C$, therefore $f_*\omega_{S/C}^{\otimes m}$ is semipositive for all $k\geq 2$. 
\end{proof}

\section{Projectivity of $\overline{\mathcal{M}_g}$}

\begin{lemma}
Let $\overline{\mathcal{M}_g}$ be the moduli space of stable curves of genus $g\geq 2$ over $\mathbb{Z}$. Then $\overline{\mathcal{M}_g}$ is projective over $\mathbb{Z}$.
\end{lemma}
\begin{proof}
First we will show that there as an ample invertible sheaf as an algebraic space. Being a stable curve is an open condition \cite[Tag 0E76]{stacks-project}. Hence, we can check locally for each stable curve $C$. Boundedness holds since $\omega_C^{\otimes 3}$ is very ample.

Completeness and separatedness follow from the stable reduction theorem.\cite[Tag 0E8C]{stacks-project} [cf.\ {[8],[5]  of Kollar}]  The automorphism group is finite and reduced since $H^0(\mathcal{T}_C)=0$.\cite[Tag 0E69]{stacks-project} The relative dualizing sheaf provides a functorial polarization which is semipositive by \ref{kollar_thm_4.3}  Hence, $\overline{\mathcal{M}_g}$ is projective over any field.

The image of the three-canonical map is a curve of degree $6g-6$, thus it is cut out by equations of degree no higher than $6g-6$. Hence $\lambda_{18g-8}$ is ample where for any $m$ we set $\lambda_m=\det \pi_*(\omega^{\otimes m}_{\mathcal{C}\overline{\mathcal{M}_g}})$, where $\pi:\mathcal{C}\to \overline{\mathcal{M}_g}$ is the universal family for the moduli space. \todo{Explain why} The image of the three-canonical map is defined by quadratic equations, making $\lambda_6$ ample.

To show projectivity over $\mathbb{Z}$, we use that $\mathbb{Q}$-invertible sheaves $\lambda_m$ exist over $\overline{\mathcal{M}_g}$. Therefore, $\lambda_6$ is relatively ample over $\mathbb{Z}$, making the moduli space $\overline{\mathcal{M}_g}$ projective over $\mathbb{Z}$.
\end{proof}


\bibliographystyle{unsrt}
\bibliography{references}
\end{document}
